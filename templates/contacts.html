<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Lista de Contactos</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-[#f3f4f6] p-6">

    <script>
        // Si no tiene permiso, redirigir
        if (localStorage.getItem("contacts_auth") !== "allowed") {
            window.location.href = "/contacts";
        }
    </script>

    <div class="max-w-4xl mx-auto bg-white p-6 rounded-3xl shadow-xl">

        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
            Contactos Registrados
        </h2>

        <!-- Botón regresar a index -->
        <div class="mb-4">
            <button onclick="window.location.href='/'"
                class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">
                ← Regresar al formulario
            </button>

        </div>

        <!-- Tabla responsive -->
        <div class="overflow-x-auto rounded-xl border border-gray-200">
            <table class="min-w-full text-left text-sm text-gray-700">

                <thead class="bg-gray-100 text-gray-700 font-semibold">
                    <tr>
                        <th class="px-4 py-3">Nombre</th>
                        <th class="px-4 py-3">Correo</th>
                        <th class="px-4 py-3">Teléfono</th>
                        <th class="px-4 py-3">Registrado</th>
                    </tr>
                </thead>

                <tbody id="tableData" class="divide-y divide-gray-200"></tbody>
            </table>
        </div>

    </div>

    <script>
        async function loadContacts() {
            const res = await fetch("/api/contacts");
            const data = await res.json();

            const tbody = document.getElementById("tableData");
            tbody.innerHTML = "";

            data.forEach(c => {
                tbody.innerHTML += `
                    <tr class="hover:bg-gray-50 transition">
                        <td class="px-4 py-3">${c.name}</td>
                        <td class="px-4 py-3">${c.email}</td>
                        <td class="px-4 py-3">${c.phone ?? ""}</td>
                        <td class="px-4 py-3">${c.created_at}</td>
                    </tr>
                `;
            });
        }

        loadContacts();
    </script>

</body>

</html>